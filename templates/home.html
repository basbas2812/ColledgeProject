{% extends "base.html" %}

{% block title %}‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å{% endblock %}

{% block content %}
<!-- üîπ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
<form id="searchForm" onsubmit="return false;">
    <input type="text" id="searchInput" name="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä" />
    <select id="plantTypeSelect" name="plantType">
        <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
        <option value="‡∏û‡∏∑‡∏ä‡πÑ‡∏£‡πà">‡∏û‡∏∑‡∏ä‡πÑ‡∏£‡πà</option>
        <option value="‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å">‡∏û‡∏∑‡∏ä‡∏ú‡∏±‡∏Å</option>
        <option value="‡πÑ‡∏°‡πâ‡∏ú‡∏•">‡πÑ‡∏°‡πâ‡∏ú‡∏•</option>
        <option value="‡πÑ‡∏°‡πâ‡∏î‡∏≠‡∏Å">‡πÑ‡∏°‡πâ‡∏î‡∏≠‡∏Å</option>
        <option value="‡πÑ‡∏°‡πâ‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö">‡πÑ‡∏°‡πâ‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
        <option value="‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£">‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£</option>
        <option value="‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î">‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏•‡πá‡∏î</option>
        <option value="‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß">‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß</option>
        <option value="‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô">‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</option>
        <option value="‡∏û‡∏∑‡∏ä‡πÉ‡∏ä‡πâ‡πÉ‡∏ö">‡∏û‡∏∑‡∏ä‡πÉ‡∏ä‡πâ‡πÉ‡∏ö</option>
    </select>
</form>

<!-- üîπ ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
<div id="plantResults">
    {% if plants and plants|length > 0 %}
    <div class="table-responsive">
        <div class="plant-grid">
            {% for p in plants %}
            <div class="plant-card">
                <a href="{{ url_for('view_plant', plant_id=p.plantId) }}">
                    <img src="{{ p.image_url }}" alt="‡∏£‡∏π‡∏õ‡∏û‡∏∑‡∏ä">
                </a>

                <div class="plant-info">
                    <h3>{{ p.plantName }}</h3>
                    <p>{{ p.description }}</p>
                </div>
            </div>
            {% endfor %}
        </div>

    </div>
    {% else %}
    <div class="alert alert-info">
        <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä</h4>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
    </div>
    {% endif %}
</div>

<script>
    async function fetchPlants() {
        const search = document.getElementById("searchInput").value;
        const plantType = document.getElementById("plantTypeSelect").value;

        const res = await fetch(`/home_search?search=${encodeURIComponent(search)}&plantType=${encodeURIComponent(plantType)}`, {
            headers: { "X-Requested-With": "XMLHttpRequest" }
        });
        const plants = await res.json();

        const container = document.getElementById("plantResults");
        if (plants.length === 0) {
            container.innerHTML = `
          <div class="alert alert-info">
              <h4>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡∏ä</h4>
              <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡∏ä‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
          </div>`;
            return;
        }

        // ‚úÖ ‡πÉ‡∏ä‡πâ url_for('static', filename='') ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ path ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏°‡∏≠
        const staticBase = "{{ url_for('static', filename='') }}";

        container.innerHTML = `
      <div class="plant-grid">
        ${plants.map(p => `
          <div class="plant-card">
              <a href="/view_plant/${p.plantId}">
                <img src="${p.image_url}" alt="‡∏£‡∏π‡∏õ‡∏û‡∏∑‡∏ä">
              </a>
              <div class="plant-info">
                  <h3>${p.plantName}</h3>
                  <p>${p.description || ""}</p>
              </div>
          </div>
        `).join("")}
      </div>
    `;
    }
    document.getElementById("searchInput").addEventListener("keyup", fetchPlants);
    document.getElementById("plantTypeSelect").addEventListener("change", fetchPlants);
    document.addEventListener("DOMContentLoaded", fetchPlants);
</script>
{% endblock %}